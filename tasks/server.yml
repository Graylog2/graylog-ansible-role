---
- name: '"graylog-server" package should be installed'
  apt:
    name: 'graylog-server'
    state: present
    update_cache: True

- name: Ownership and privileges should be set
  file:
    path: '/etc/graylog/server'
    owner: graylog
    group: graylog
    mode: 0750

- name: Graylog server should be configured
  template:
    src: 'graylog.server.conf.j2'
    dest: '/etc/graylog/server/server.conf'
    owner: graylog
    group: graylog
    mode: 0644
  notify: restart graylog-server

- name: Graylog ElasticSearch should be configured
  template:
    src: 'graylog.server.elasticsearch.yml.j2'
    dest: '/etc/graylog/server/elasticsearch.yml'
    owner: graylog
    group: graylog
    mode: 0644
  notify: restart graylog-server

- name: Graylog server defaults should be configured
  template:
    src: 'graylog.server.default.j2'
    dest: '/etc/default/graylog-server'
    owner: graylog
    group: graylog
    mode: 0644
  notify: restart graylog-server

- name: Graylog server should start after reboot
  file:
    path: '/etc/init/graylog-server.override'
    state: absent
